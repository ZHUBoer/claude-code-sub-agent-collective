# 全局决策引擎 (始终激活)

## 自动委派基础设施

### 双重自动委派系统
**由两个互补的系统处理不同的任务交接触发点：**

#### 1. 我的交接信息 (本文件 `DECISION.md` 的逻辑)
**强制性行为要求**：在每一轮响应中，在输出任何内容之前，必须执行以下步骤：
1. **检查上下文文件**：如果 `.claude/handoff/NEXT_ACTION.json` 文件存在，则读取其内容。
2. **执行委派**：如果文件存在且包含 `"action": "delegate"`，应立即调用任务(Task)工具，然后删除该文件。
3. **检查我的上一条信息**：确认我的上一条回复是否以特定的交接模式结尾：`Use the ([a-z0-9-]+) subagent to .+`。
4. **规范化处理**：在进行模式匹配前，将 Unicode 编码的各种破折号 (`‑–—−`) 统一转换为标准连字符 (`-`)。
5. **自动委派**：一旦匹配到该模式，立即使用提取出的 Agent 名称调用任务(Task)工具，并终止当前操作。
6. **禁止附加分析**：在执行自动委派时，绝不添加任何解释、摘要，也禁止加载行为规则。
7. **最高优先级**：此委派操作的优先级高于所有其他行为。

#### 2. Agent 的交接信息 (由 Hook 系统处理)
**由钩子脚本 `.claude/hooks/test-driven-handoff.sh` 自动处理:**
- 钩子脚本负责检测 Agent 输出内容中的交接模式。
- 钩子脚本会自动发起 `Task()` 调用，并完成 Unicode 字符的规范化。
- 此过程完全自动化，无需手动干预。

## 路由决策
**对于 `/van` 命令**：用户已明确请求进入“集体(collective)模式”，因此需要从 `CLAUDE.md` 文件加载完整的行为上下文。
**对于普通问题**：应使用标准的 Claude 行为进行回应，并忽略“集体行为规则”。
**对于 Agent 间的任务交接**：仅执行自动委派（逻辑如上所述），无需加载任何行为规则。

## 上下文加载规则
- **自动委派（由“我”发起）**：立即执行 `Task()`，不加载任何额外内容。
- **自动委派（由 Agent 发起）**：由钩子系统处理，无需加载上下文。
- **当使用 `/van` 命令时**：加载“集体行为规则”和“路由矩阵”。
- **在普通对话中**：采用标准的 Claude 行为，同时保留自动委派的能力。

---
*注意：本文件仅包含决策逻辑与自动委派基础设施，不包含行为规则。*